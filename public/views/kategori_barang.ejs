<!doctype html>
<html lang="en" data-pc-preset="preset-1" data-pc-sidebar-caption="true" data-pc-direction="ltr" dir="ltr" data-pc-theme="light">
<!-- [Head] start -->

<head>
  <title>Kategori Barang</title>
  <!-- [Meta] -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="description"
    content="Datta Able is trending dashboard template made using Bootstrap 5 design framework. Datta Able is available in Bootstrap, React, CodeIgniter, Angular,  and .net Technologies."
  />
  <meta
    name="keywords"
    content="Bootstrap admin template, Dashboard UI Kit, Dashboard Template, Backend Panel, react dashboard, angular dashboard"
  />
  <meta name="author" content="CodedThemes" />

  <!-- [Favicon] icon -->
  <link rel="icon" href="../assets/images/favicon.svg" type="image/x-icon" />
  <!-- [Font] Family -->
 <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />
<!-- [phosphor Icons] https://phosphoricons.com/ -->
<link rel="stylesheet" href="../assets/fonts/phosphor/duotone/style.css" />
<!-- [Tabler Icons] https://tablericons.com -->
<link rel="stylesheet" href="../assets/fonts/tabler-icons.min.css" />
<!-- [Feather Icons] https://feathericons.com -->
<link rel="stylesheet" href="../assets/fonts/feather.css" />
<!-- [Font Awesome Icons] https://fontawesome.com/icons -->
<link rel="stylesheet" href="../assets/fonts/fontawesome.css" />
<!-- [Material Icons] https://fonts.google.com/icons -->
<link rel="stylesheet" href="../assets/fonts/material.css" />
<!-- [Template CSS Files] -->
<link rel="stylesheet" href="../assets/css/style.css" id="main-style-link" />
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xxjapp/xdialog@3/xdialog.min.css">
     <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css"
    />
</head>
<!-- [Head] end -->
<!-- [Body] Start -->
+
<body>
  <!-- [ Pre-loader ] start -->
<div class="loader-bg fixed inset-0 bg-white dark:bg-themedark-cardbg z-[1034]">
  <div class="loader-track h-[5px] w-full inline-block absolute overflow-hidden top-0">
    <div class="loader-fill w-[300px] h-[5px] bg-primary-500 absolute top-0 left-0 animate-[hitZak_0.6s_ease-in-out_infinite_alternate]"></div>
  </div>
</div>
<!-- [ Pre-loader ] End -->
 <!-- [ Sidebar Menu ] start -->
<nav class="pc-sidebar">
  <div class="navbar-wrapper">
    <div class="m-header flex items-center py-4 px-6 h-header-height">
      <a href="../dashboard/index.html" class="b-brand flex items-center gap-3">
        <!-- ========   Change your logo from here   ============ -->
        <img src="../assets/images/logo-white.svg" class="img-fluid logo logo-lg" alt="logo" />
        <img src="../assets/images/favicon.svg" class="img-fluid logo logo-sm" alt="logo" />
      </a>
    </div>
    <div class="navbar-content h-[calc(100vh_-_74px)] py-2.5">
      <ul class="pc-navbar">
        <li class="pc-item pc-caption">
          <label>Navigation</label>
        </li>
        <li class="pc-item">
        <li class="pc-item">
          <a href="/home" class="pc-link">
            <span class="pc-micon">
              <i data-feather="home"></i>
            </span>
            <span class="pc-mtext">Home</span>
          </a>
        </li>
        <li class="pc-item">
          <a href="/kategori_barang" class="pc-link">
            <span class="pc-micon">
              <i data-feather="grid"></i>
            </span>
            <span class="pc-mtext">Kategori Barang</span>
          </a>
        </li>
        <li class="pc-item">
          <a href="/barang" class="pc-link">
            <span class="pc-micon">
              <i data-feather="package"></i>
            </span>
            <span class="pc-mtext">Barang</span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>
<!-- [ Sidebar Menu ] end -->
 <!-- [ Header Topbar ] start -->
<header class="pc-header">
  <div class="header-wrapper flex max-sm:px-[15px] px-[25px] grow"><!-- [Mobile Media Block] start -->
<div class="me-auto pc-mob-drp">
  <ul class="inline-flex *:min-h-header-height *:inline-flex *:items-center">
    <!-- ======= Menu collapse Icon ===== -->
    <li class="pc-h-item pc-sidebar-collapse max-lg:hidden lg:inline-flex">
      <a href="#" class="pc-head-link ltr:!ml-0 rtl:!mr-0" id="sidebar-hide">
        <i data-feather="menu"></i>
      </a>
    </li>
    <li class="pc-h-item pc-sidebar-popup lg:hidden">
      <a href="#" class="pc-head-link ltr:!ml-0 rtl:!mr-0" id="mobile-collapse">
        <i data-feather="menu"></i>
      </a>
    </li>
    <li class="dropdown pc-h-item">
      <a class="pc-head-link dropdown-toggle me-0" data-pc-toggle="dropdown" href="#" role="button"
        aria-haspopup="false" aria-expanded="false">
        <i data-feather="search"></i>
      </a>
      <div class="dropdown-menu pc-h-dropdown drp-search">
        <form class="px-2 py-1" id="serach_form">
          <input type="search" id="search" class="form-control !border-0 !shadow-none" placeholder="Search here. . ." />
        </form>
      </div>
    </li>
  </ul>
</div>
<!-- [Mobile Media Block end] -->
<div class="ms-auto">
  <ul class="inline-flex *:min-h-header-height *:inline-flex *:items-center">
    <li class="dropdown pc-h-item">
      <a class="pc-head-link dropdown-toggle me-0" data-pc-toggle="dropdown" href="#" role="button"
        aria-haspopup="false" aria-expanded="false">
        <i data-feather="sun"></i>
      </a>
      <div class="dropdown-menu dropdown-menu-end pc-h-dropdown">
        <a href="#!" class="dropdown-item" onclick="layout_change('dark')">
          <i data-feather="moon"></i>
          <span>Dark</span>
        </a>
        <a href="#!" class="dropdown-item" onclick="layout_change('light')">
          <i data-feather="sun"></i>
          <span>Light</span>
        </a>
        <a href="#!" class="dropdown-item" onclick="layout_change_default()">
          <i data-feather="settings"></i>
          <span>Default</span>
        </a>
      </div>
    </li>
    <li class="dropdown pc-h-item header-user-profile">
      <a class="pc-head-link dropdown-toggle arrow-none me-0" data-pc-toggle="dropdown" href="#" role="button"
        aria-haspopup="false" data-pc-auto-close="outside" aria-expanded="false">
        <i data-feather="user"></i>
      </a>
      <div class="dropdown-menu dropdown-user-profile dropdown-menu-end pc-h-dropdown p-2 overflow-hidden">
        <div class="dropdown-header flex items-center justify-between py-4 px-5 bg-primary-500">
          <div class="flex mb-1 items-center">
            <div class="shrink-0">
              <img src="../assets/images/user/avatar-2.jpg" alt="user-image" class="w-10 rounded-full" />
            </div>
            <div class="grow ms-3">
              <h6 class="mb-1 text-white"><%= kategoriList.user.nama %> ðŸ––</h6>
              <span class="text-white"><%= kategoriList.user.email %></span>
            </div>
          </div>
        </div>
        <div class="dropdown-body py-4 px-5">
          <div class="profile-notification-scroll position-relative" style="max-height: calc(100vh - 225px)">
            <div class="grid my-3">
              <button class="btn btn-primary flex items-center justify-center" onclick="logoutHandler()">
                <svg class="pc-icon me-2 w-[22px] h-[22px]">
                  <use xlink:href="#custom-logout-1-outline"></use>
                </svg>
                Logout
              </button>
            </div>
          </div>
        </div>
      </div>
    </li>
  </ul>
</div></div>
</header>
<!-- [ Header ] end -->



  <!-- [ Main Content ] start -->
  <div class="pc-container">
    <div class="pc-content">
      <!-- [ breadcrumb ] start -->
      <div class="page-header">
        <div class="page-block">
          <div class="page-header-title">
            <h5 class="mb-0 font-medium">Kategori Barang</h5>
          </div>
          <ul class="breadcrumb">
            <li class="breadcrumb-item"><a href="javascript: void(0)">Navigation</a></li>
            <li class="breadcrumb-item" aria-current="page">Kategori Barang</li>
          </ul>
        </div>
      </div>
      <!-- [ breadcrumb ] end -->


      <!-- [ Main Content ] start -->

      <div class="grid grid-cols-12 gap-x-6">
        <!-- [ sample-page ] start -->
        <div class="col-span-12">
          <div class="card">
            <div class="card-header flex justify-between items-center">
              <h5>Kategori Barang</h5>
                <button class="btn btn-success" onclick="openDialogForm()">Tambahkan Kategori</button>
            </div>
            <div class="card-body">
                <table class="table table-hover">
  <thead>
    <tr>
      <th>Nama Kategori</th>
      <th>Nama Pembuat</th>
      <th>Role</th>
      <th>Dibuat Pada</th>
      <th>Diupdate Pada</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody>
    <% kategoriList.data.forEach((kategori) => { %>
      <tr class="unread">
        <td><%= kategori.nama %></td>
        <td><%= kategori.pembuat?.nama || '-' %></td>
        <td><%= kategori.pembuat?.role || '-' %></td>
        <td>
          <%= new Date(kategori.created_at).toLocaleString('id-ID', {
            day: 'numeric', month: 'short', year: 'numeric',
            hour: '2-digit', minute: '2-digit'
          }) %>
        </td>
        <td>
          <%= new Date(kategori.update_at).toLocaleString('id-ID', {
            day: 'numeric', month: 'short', year: 'numeric',
            hour: '2-digit', minute: '2-digit'
          }) %>
        </td>
        <td>
          
          <a href="#" onclick="editDIalog('<%= kategori.id %>')" class="badge bg-theme-bg-1 text-white text-[12px]">Edit</a>
          <a href="#" onclick="deleteDIalog('<%= kategori.id %>')" class="badge bg-theme-bg-2 text-white text-[12px] mx-1">Delete</a>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>
<div class="flex justify-between items-center">
  <% if (kategoriList.page > 1) { %>
    <button class="border p-2" onclick="prev()">Prev</button>
  <% } else { %>
    <span></span> <!-- Placeholder agar tombol center -->
  <% } %>

  <span>Halaman <%= kategoriList.page %> dari <%= kategoriList.max_page %></span>

  <% if (kategoriList.page < kategoriList.max_page) { %>
    <button class="border p-2" onclick="next()">Next</button>
  <% } else { %>
    <span></span> <!-- Placeholder agar tombol center -->
  <% } %>
</div>


            </div>
          </div>

        </div>
        <!-- [ sample-page ] end -->
      </div>
      <!-- [ Main Content ] end -->
    </div>
  </div>
  <!-- [ Main Content ] end -->
  <footer class="pc-footer">
    <div class="footer-wrapper container-fluid mx-10">
      <div class="grid grid-cols-12 gap-1.5">
        <div class="col-span-12 sm:col-span-6 my-1">
          <p class="m-0"></p>
            <a href="https://codedthemes.com/" class="text-theme-bodycolor dark:text-themedark-bodycolor hover:text-primary-500 dark:hover:text-primary-500" target="_blank">CodedThemes</a>
            , Built with â™¥ for a smoother web presence.
          </p>
        </div>
        <div class="col-span-12 sm:col-span-6 my-1 justify-self-end">
                 <p class="inline-block max-sm:mr-3 sm:ml-2">Distributed by <a href="https://themewagon.com" target="_blank">Themewagon</a></p>
        </div>
      </div>
    </div>
  </footer>
 <!-- Required Js -->
   <script src="https://cdn.jsdelivr.net/gh/xxjapp/xdialog@3/xdialog.min.js"></script>
<script src="../assets/js/plugins/simplebar.min.js"></script>
<script src="../assets/js/plugins/popper.min.js"></script>
<script src="../assets/js/icon/custom-icon.js"></script>
<script src="../assets/js/plugins/feather.min.js"></script>
<script src="../assets/js/component.js"></script>
<script src="../assets/js/theme.js"></script>
<script src="../assets/js/script.js"></script>
<script src="/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>

<script>
  const notification = new Notyf({
        duration: 5000,
        position: {
          x: "right",
          y: "top",
        },
        types: [
          {
            type: "warning",
            dismissible: true,
          },
          {
            type: "error",
            dismissible: true,
          },
        ],
      });
  const page = parseInt('<%= kategoriList.page  %>')
  const maxPage = parseInt('<%= kategoriList.max_page %>')
  function prev(){
    if(page > 1){
      window.location.href = `/kategori_barang?page=${page - 1}`

    }
  }
  function next(){
    if(page < maxPage){
      window.location.href = `/kategori_barang?page=${page + 1}`
    }
  }

  function openDialogForm() {
    xdialog.open({
      title: 'Tambahkan Kategori',
      body: `
        <form id="formSubmit" onsubmit="return submitForm(event)">
          <div class="form-group mb-2">
            <label for="nama">Nama:</label>
            <input type="text" id="nama" name="nama" class="form-control" required />
          </div>
          <div class="mt-3 text-right">
            <button type="submit" class="btn btn-success">Tambahkan</button>
          </div>
        </form>
      `,
      buttons: [] // Hapus tombol OK/CANCEL default
    });
  }

  async function editDIalog(id) {
    try {
      const response = await fetch("/api/kategori_barang?id="+id, {
        method: "GET",
        headers: {
          "Accept": "application/json",
          "Content-Type": "application/json"
        },
      })
      const responseJson = await response.json()
      if(responseJson.error) throw new Error(responseJson.message)
      xdialog.open({
      title: 'Edit Kategori',
      body: `
        <form id="formSubmit" onsubmit="return submitFormEdit(event)">
          <input class="hidden" id="pancing" value="${id}"></input>
          <div class="form-group mb-2">
            <label for="nama">Nama:</label>
            <input type="text" id="nama_EDIT" name="nama" class="form-control" required value="${responseJson.data.nama}" />
          </div>
          <div class="mt-3 text-right">
            <button type="submit" class="btn btn-success">Simpan</button>
          </div>
        </form>
      `,
      buttons: [] // Hapus tombol OK/CANCEL default
    });
    } catch (error) {
      notification.error(error.message)
    }
  }

    async function deleteDIalog(id) {
    try {
      const response = await fetch("/api/kategori_barang?id="+id, {
        method: "GET",
        headers: {
          "Accept": "application/json",
          "Content-Type": "application/json"
        },
      })
      const responseJson = await response.json()
      if(responseJson.error) throw new Error(responseJson.message)
       xdialog.confirm("Apakah anda yakin untuk menghapus " + responseJson.data.nama, "Konfirmasi Hapus", {
        onok: async function(){
          try {
            const response = await fetch("/api/kategori_barang", {
              method: "delete",
              headers: {
                Accept: "application/json",
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                id: id
              })
            })
            const responseJson = await response.json()
            if(responseJson.error) throw new Error(responseJson.message)

            notification.success(responseJson.message)
            setTimeout(() => {
               window.location.reload()
            }, 2000);
          } catch (error) {
             notification.error(error.message)   
          }
        }
      })
    } catch (error) {
      notification.error(error.message)
    }
  }



  async function submitForm(event) {
    event.preventDefault();
    const nama = event.target.nama.value
    try {
      if(!nama) throw new Error("Masukkan nama kategori")
      const response = await fetch("/api/kategori_barang", {
        method: "POST",
        headers: {
          Accept: "application/json",
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          nama: nama
        })
      })
      const responseJson = await response.json()
      if(responseJson.error) throw new Error(responseJson.message)

      notification.success(responseJson.message)
      setTimeout(() => {
        window.location.reload()
      }, 2000);
    } catch (error) {
      notification.error(error.message)
    }
  }

    async function submitFormEdit(event) {
    event.preventDefault();
    const nama = event.target.nama_EDIT.value
    try {
      if(!nama) throw new Error("Masukkan nama kategori")
      const response = await fetch("/api/kategori_barang", {
        method: "PUT",
        headers: {
          Accept: "application/json",
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          nama: nama,
          id: event.target.pancing.value
        })
      })
      const responseJson = await response.json()
      if(responseJson.error) throw new Error(responseJson.message)

      notification.success(responseJson.message)
      setTimeout(() => {
        window.location.reload()
      }, 2000);
    } catch (error) {
      notification.error(error.message)
    }
  }

  $("#serach_form").on("submit",async function(event){
    event.preventDefault()
    window.location.href = `/kategori_barang?q=${event.target.search.value}`
  })

  function logoutHandler() {
        xdialog.confirm("Apakah anda yakin untuk logout?", "Konfirmasi Logout", {
        onok: async function(){
         notification.success("Logout Berhasil !")
         setTimeout(() => {
           window.location.href = "/logout"
         }, 2000);
        }
      })
  }
</script>

<div class="floting-button fixed bottom-[50px] right-[30px] z-[1030]">
</div>


<script>
  layout_change('false');
</script>
 

<script>
  layout_theme_sidebar_change('dark');
</script>

 
<script>
  change_box_container('false');
</script>
 
<script>
  layout_caption_change('true');
</script>
 
<script>
  layout_rtl_change('false');
</script>
 
<script>
  preset_change('preset-1');
</script>
 
<script>
  main_layout_change('vertical');
</script>


</body>
<!-- [Body] end -->

</html>
